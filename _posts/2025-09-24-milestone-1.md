---
layout: post
title: Milestone 1
---

Authors: Anissa Djouhri, Qianyun Shen, Gafran Ijaz, Saleem Ibrahim (Team 1) 
## <span style="color:#1E90FF;">Data Acquisition Tutorial</span>

code related to it:
`ift6758/data/acquisition.py`
`ift6758/data/acquisition.ipynb`

### **Introduction**

Data analytics plays an important role in sports today. Teams and coaches use data to understand player performance and make better decisions during games.
Since hockey is one of the most important sports in Canada, it is a great subject to explore using data analytics.

To start any analysis, we first need to collect detailed information about each game.
For every event that happens in a game, the NHL records the **time**, **event type**, **location**, **players involved**, and other relevant information.
This data can be accessed through the *play-by-play* API, which is structured as:
https://api-web.nhle.com/v1/gamecenter/{GAME_ID}/play-by-play

---

### **The GAME_ID Format**

Each game in the NHL is assigned a unique `GAME_ID` that encodes the **season**, **game type**, and **game number**.
The format and meaning of the digits are as follows:

- The first 4 digits represent the starting year of the season.
  For example, a game played in March 2018 still belongs to the 2017–2018 season and starts with 2017.

- The next 2 digits specify the type of game:
  - `01` = preseason
  - `02` = regular season
  - `03` = playoffs
  - `04` = all-star games

- The last 4 digits identify the specific game number.

  - For **regular-season** games, this number ranges from 0001 up to the total number of games in that season.

  - For **playoff** games, these digits have additional meaning:
    - The second digit indicates the playoff round (R1–R4).
    - The third digit identifies the matchup number within that round.
    - The fourth digit specifies the game number within the best-of-seven series.

**Example:**
`2022030411` corresponds to the *2022–2023 playoffs*, round 4 , matchup 1, and game 1.

---

### **Goal and Workflow**

The goal of this step is to collect the NHL play-by-play data using the official API and store it locally in a structured format.
We designed a Python program that can automatically download both regular-season and playoff games, while avoiding repeated downloads by checking if files already exist.


Our program follows these main steps:

1. Build the correct `GAME_ID` for each game in a season.
2. Check if the file already exists locally.
3. If not, send a request to the API to download the JSON data.
4. Save the data in a folder organized by season and game type (regular or playoff).

---

### **Function Overview**



#### `write_json()`
This function takes a Python dictionary (the JSON response from the API) and writes it to a local .json file.
It automatically creates folders if they don’t exist, ensuring that data from each season is saved in the correct directory.

#### `read_json()`
This function  loads an existing .json file from disk and returns its contents as a Python dictionary.
By using this function, the program can skip unnecessary downloads if the file is already available locally.



#### `get_game()`
This is the core function of the program.
It takes a single `GAME_ID` and an output directory as inputs.
The function first checks if the game’s file already exists; if yes, it loads it from disk.
Otherwise, it requests the data from the NHL API, saves it locally using `write_json()`, and returns the downloaded data.
This logic ensures that the process is both efficient and repeatable.

#### `download_regular()`
This function automates the downloading process for an entire **regular season**.
It generates all possible `GAME_ID`s with the prefix , it calls `get_game()` to fetch and save the data if it is not already present.
The files are stored in folders like: dataStore/year/regular/

Using an upper bound of around 1,312 games per season safely covers all possible games.

#### `download_playoff()`
This function handles the **playoff data**.
It uses the prefix `03` for playoff `GAME_ID`s, the last three digits include the **round number (1–4)**, the **matchup number**, and the **game number (1–7)**.
Each playoff year starts with **eight matchups** in Round 1, followed by four in Round 2, two in Round 3, and one in Round 4.
The function systematically generates each `GAME_ID` for all rounds and matchups, and downloads them with `get_game()`.
The results are stored under:
dataStore/year/playoff/


#### `download_all()`
This is a simple wrapper function that combines both previous functions.
It downloads all regular-season and playoff games for a given year with a single command.
For example:


`download_all(2016, "./dataStore")`

This command automatically creates the correct folder structure and collects every game from the 2016–2017 season.


## <span style="color:#1E90FF;">Interactive Debugging Tool Question<span>
code related to it:

`ift6758/data/load_game.py`
`notebooks/debugging.ipynb`

We built a small interactive tool  using ipywidgets to browse play-by-play data game-by-game and event-by-event.
Users can choose the season year, switch between regular and playoff games, select a game ID, and scrub through events with a slider.

The two main function are:

#### `plot_ring(ring_path, play)`
This function plots a single hockey event on a rink image.
It reads the event’s coordinates from the data, draws the rink, places a point where the event happened, and labels it with the event ID.
It also adds a title showing the period, time, and event type.

---

#### `on_game_change(root, ring_path, year_widget, season_widget, game_widget, event_widget, out=None)`
This function defines how the interactive tool reacts when the user changes any widget (season, game, or event).
It loads the selected game data, updates the event range, and refreshes the output area to show the event summary and the updated rink plot.


Here is what our interactive tool looks like:
![interactive picture](public/milestone1/interactive.png)

The rink diagram  displays the event location.
This example corresponds to **Event #52**, a **faceoff** occurring at the start of the first period (**P1 00:00**) in Game ID 1194 (2016 season).

- **Teams:** BOS (Home) vs OTT (Away)
- **Final Score:** BOS 1 – OTT 2
- **Shots on Goal:** BOS 29  \|  OTT 26

## <span style="color:#1E90FF;">Tidy Data Questions<span>
code related to it: `ift6758/data/tidying.py`
`notebooks/tidying.ipynb`

During our  tidy procedure, we found that the new data feed no longer has information that shows if a goal is a short-handed goal, even strength or power play goal. This can be determined from the situationCode that is present and knowing the team what the scorer is associated to. We use four characters to represent the four-digit situation code. The meaning of each character is as follows:

G – goalie on ice for away team

l – on ice skaters for away team

i – on ice skaters for home team

g – goalie on ice for home team

Here's a small snippet of our final dataframe

![tidy_data](public/milestone1/tidyData.png)

We could use these features  from the data available in this dataset:

- **Shot distance**: It measures how far a player is from the opponent's net when taking a shot. It is calculated using the x and y coordinates provided in the play by play data.
  The closer the player is to the net, the higher the chance of scoring.

- **Rebound shot**:It means a shot taken immediately after a prior shot by the same team, often indicate that  the goalie is out of position.
we could compute it by checking the same team’s previous shot-like event and point
as a rebound when the time since the previous attempt is ≤ 5 s and the distance between locations is ≤ 20 ft. We label it as 1 when
rebound and 0 if not.

- **Shot off the rush**: It means a shot taken quickly after a fast up-ice transition, before the defense is set. This feature captures quick-entry, immediate-shot situations that angle and distance alone can’t fully explain.
We label it as 1 when the shooter makes forward progress toward the attacking net (ex: ≥50 ft) and the time since the
same team’s previous event is ≤6 s; otherwise 0.

## <span style="color:#1E90FF;">Simple Visualizations</span>

code related to it:
`ift6758/data/simple_visualization.py`
`notebooks/simple_visualization.ipynb`

**Which Shot Types Are Most Common and Most Dangerous? (Question1)**:

![simpleQ1](public/milestone1/SimpleQ1.png)
In this figure, the values displayed above the bars indicate the goal percentage, which corresponds to the ratio of goals to total shots. We can observe from the figure that, when comparing the number of goals to the number of shots for each shot type, the **deflected shot** appears to be the **most successful**, converting 19.8% of the time.
The tip-in follows closely with a success rate of 19.5%. This indicates that **deflected shots** are the **most dangerous**, as they are the most likely to result in a goal.
On the other hand, the **wrist shot** is clearly the **most common** type of shot, as shown by its much higher count compared to the others.
We chose this figure because it effectively conveys all the key information needed to compare shot types at a glance. The **height of the bars** represents how often each shot type was attempted, the **red portion** of each bar shows how many of those resulted in goals, and the percentage labels on top provide a quick and precise measure of scoring efficiency. This visualization allows us to quickly identify both the most frequently used and the most effective shot types within a easy-to-read chart.


**How Does Shot Distance Relate to Scoring Chances? (Question 2)**:

![simpleQ2](public/milestone1/SimpleQ2.png)
From the visualization, we can observe a clear inverse relationship between shot distance and goal probability: the **farther** a shot is taken from the net, the **less** likely it is to result in a goal. Conversely, shots taken from closer ranges have a much higher chance of scoring. This trend remains consistent across all three seasons.

In the comparison plot (bottom right), we can see that the curves for the 2018–19, 2019–20, and 2020–21 seasons follow almost identical patterns, indicating that the relationship between distance and scoring probability has remained **stable** over time.

We chose this figure because it provides both a detailed view of each individual season and a concise comparative overview. The individual plots make it easier to examine season-specific variations, while the combined plot highlights the overall trend and confirms that shooting efficiency relative to distance has not changed significantly across the three seasons.

**Goal Percentage by Distance and Shot Type (Question 3)**:

![simpleQ3](public/milestone1/SimpleQ3.png)
The figure illustrates the relationship between goal percentage and shot distance for different shot types during the 2018–2019 NHL season. Overall, we observe that the likelihood of scoring **decreases** significantly as the distance from the net **increases**, regardless of the shot type.

Among all shot types, wrap-around and tip-in shots stand out as the most dangerous, showing the highest goal percentages, often exceeding **30–50%** at close range. These types of shots usually occur near the crease, where goalies have limited time to react and positioning becomes critical. Deflected shots also exhibit relatively high conversion rates at mid-range distances, as their unpredictable trajectories make them difficult to stop. In contrast, wrist and snap shots display moderate effectiveness at shorter ranges but decline steadily as distance increases. Interestingly, slap shots display a noticeable peak around 18 feet, with a goal rate of about 25%, suggesting that they can be particularly threatening when taken from this distance — likely due to their speed and power. In contrast, backhand and wrist shots tend to have lower goal percentages overall, especially as distance increases.

Overall, the results emphasize that both proximity and shot type strongly influence scoring chances, with close-range and fast, unpredictable shots proving the most effective.



## <span style="color:#1E90FF;">Advanced Visualizations: Shot Maps</span>
code related to it:
`ift6758/data/advanced_visualization.py`
`notebooks/advanced_vs.ipynb`

figures are created in the following directory after execution
`ift6758/data/plot_figures`
format
`offensive_zone_{season}.html`
**Interactive Shot Maps: Offensive Zone Visualizations (Question 1)**:

{% include offensive_zone_20162017.html %}
{% include offensive_zone_20172018.html %}
{% include offensive_zone_20182019.html %}
{% include offensive_zone_20192020.html %}
{% include offensive_zone_20202021.html %}

**What Do the Shot Maps Tell Us About Teams? (Question 2)**:

The excess shot heatmap shows how each team compares across the league, highlighting their favorite shooting zones and giving a sense of offensive strength. Dominant teams tend to take more shots than the league average and perhaps there are certain players who are more effective at shooting in a specific range. We kept –0.1 to +0.1 as a neutral color so small differences fade out and only the real hot and cold spots stand out.

**Colorado Avalanche: Comparing 2016-17 vs 2020-21 Seasons (Question 3)**:
![AdvanceQ3A](public/milestone1/AdvanceQ3A.png)

The Avalanche’s 2016/2017 excess shot map shows a clear **negative** concentration around the net, this implies  they took far fewer shots from good scoring areas compared to the league average. Since shooting closer to the net strongly correlates with goal scoring (see earlier figure on correlation of shot and goal compared to distance), this suggests their offensive production was limited. Instead, the Avalanche generated more shots from the middle-left side of the rink, but these attempts came from farther out, where chances of scoring are lower.

Overall, this pattern shows the team likely struggled offensively that season. (Because this only reflects shooting, we can’t infer anything about their defensive play.) if we observe their standings that year, we find evidence that supports the team struggled in the **16/17 season**, having the lowest points in the league. Most [articles](https://www.denverpost.com/2017/04/06/colorado-avalanche-2017-season-in-review/) suggest that the avalanche were poor this season due to major injuries on key players as well as coach instability with a new head coach joining the team

![AdvanceQ3B](public/milestone1/AdvanceQ3B.png)
![AdvanceQ3C](public/milestone1/AdvanceQ3C.png)


![AdvanceQ3D](public/milestone1/AdvanceQ3D.png)

Compared to the previous graph, the Avalanche generated more shots than the league average across almost the entire rink, especially near the net. This is a stark difference to their 2016/2017 season, when they were shooting less than the league in those critical areas. The deeper red zones highlight how much more effective they were offensively. While we cannot conclude their overall performance without examining defense, this season clearly placed them among the stronger offensive teams. The results in the table as well reinforce these findings (see below).

![AdvanceQ3E](public/milestone1/AdvanceQ3E.png)

![AdvanceQ3F](public/milestone1/AdvanceQ3F.png)


**Sabres vs Lightning: Insights from 2018–2021 Shot Maps (Question 4)** 


|![AdvanceQ3I](public/milestone1/AdvanceQ3I.png){:width="300px"} | ![AdvanceQ3J](public/milestone1/AdvanceQ3J.png){:width="300px"}| ![AdvanceQ3G](public/milestone1/AdvanceQ3G.png){:width="300px"} |

 |![AdvanceQ3H](public/milestone1/AdvanceQ3H.png){:width="300px"} |![AdvanceQ3K](public/milestone1/AdvanceQ3K.png){:width="300px"} |![AdvanceQ3L](public/milestone1/AdvanceQ3L.png){:width="300px"} |
 
As we can see from the excess shot map of the Buffalo Sabres, their excess shot map for the year **2018-2019** all the way to the year **2020-2021** is very low compared to league average which is shown by the deep blue hue. The entirety of the middle lain is completely blue showing how they don't take the vast majority of their shots from the middle.

When we compare this heatmap for the Tampa Bay Lightning, which from the years **2018-2019** up till **2019-2020**, their excess shots are very centered in the middle lain straight towards the goal and it is highly concentrated around this area. They take less shots compared to the league in any other region comparatively to the central lane. This behaviour changes in the year 2020-2021 for the Lightnings where their excess shots comparatively to the league is **more** from the back right lane around 60 feet from the goal post and at a same distance from the goal post in the middle lane. This could be an outlier, but the underlying premise in these 3 year groups being that they take a significant amount of shots more from the middle lane which could lead to the following hypothesis:

The team which shoots more comparatively to other teams from an advantageous position, the **middle lane**, has a higher success of landing the shots and scoring than if a team, such as the Buffalo Sabres, shoots from mostly anywhere else but the middle lane. So from an observation purely done on this sample size of 2 teams, we can make a naive assumption that the teams which shoot more from the middle lanes compared to the league average have a higher chance of **winning** more games than if they were to shoot from other places than the middle lane.

References and sources:

[https://www.nhl.com/standings/2021-05-19/division](https://www.nhl.com/standings/2021-05-19/division)

[https://www.hockey-reference.com/teams/COL/2021.html](https://www.hockey-reference.com/teams/COL/2021.html )

[https://www.nhl.com/standings/2017-04-09/league](https://www.nhl.com/standings/2017-04-09/league)

[https://www.thescore.com/news/1276615](https://www.nhl.com/standings/2017-04-09/league)